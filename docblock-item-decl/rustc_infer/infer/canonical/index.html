<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="Canonicalization is the key to constructing a query in the middle of type inference. Ordinarily, it is not possible to store types from type inference in query keys, because they contain references to inference variables whose lifetimes are too short and so forth. Canonicalizing a value T1 using `canonicalize_query` produces two things:"><meta name="keywords" content="rust, rustlang, rust-lang, canonical"><title>rustc_infer::infer::canonical - Rust</title><link rel="preload" as="font" type="font/woff2" crossorigin href="../../../SourceSerif4-Regular.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../../FiraSans-Regular.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../../FiraSans-Medium.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../../SourceCodePro-Regular.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../../SourceSerif4-Bold.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../../SourceCodePro-Semibold.ttf.woff2"><link rel="stylesheet" href="../../../normalize.css"><link rel="stylesheet" href="../../../rustdoc.css" id="mainThemeStyle"><link rel="stylesheet" href="../../../ayu.css" disabled><link rel="stylesheet" href="../../../dark.css" disabled><link rel="stylesheet" href="../../../light.css" id="themeStyle"><script id="default-settings" ></script><script src="../../../storage.js"></script><script defer src="../../../main.js"></script><noscript><link rel="stylesheet" href="../../../noscript.css"></noscript><link rel="alternate icon" type="image/png" href="../../../favicon-16x16.png"><link rel="alternate icon" type="image/png" href="../../../favicon-32x32.png"><link rel="icon" type="image/svg+xml" href="../../../favicon.svg"></head><body class="rustdoc mod"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="mobile-topbar"><button class="sidebar-menu-toggle">&#9776;</button><a class="sidebar-logo" href="../../../rustc_infer/index.html"><div class="logo-container"><img class="rust-logo" src="../../../rust-logo.svg" alt="logo"></div></a><h2 class="location"></h2></nav><nav class="sidebar"><a class="sidebar-logo" href="../../../rustc_infer/index.html"><div class="logo-container"><img class="rust-logo" src="../../../rust-logo.svg" alt="logo"></div></a><h2 class="location"><a href="#">Module canonical</a></h2><div class="sidebar-elems"><section><div class="block"><ul><li><a href="#modules">Modules</a></li><li><a href="#structs">Structs</a></li><li><a href="#enums">Enums</a></li><li><a href="#types">Type Definitions</a></li></ul></div></section></div></nav><main><div class="width-limiter"><div class="sub-container"><a class="sub-logo-container" href="../../../rustc_infer/index.html"><img class="rust-logo" src="../../../rust-logo.svg" alt="logo"></a><nav class="sub"><form class="search-form"><div class="search-container"><span></span><input class="search-input" name="search" autocomplete="off" spellcheck="false" placeholder="Click or press ‚ÄòS‚Äô to search, ‚Äò?‚Äô for more options‚Ä¶" type="search"><div id="help-button" title="help" tabindex="-1"><button type="button">?</button></div><div id="settings-menu" tabindex="-1"><a href="../../../settings.html" title="settings"><img width="22" height="22" alt="Change settings" src="../../../wheel.svg"></a></div></div></form></nav></div><section id="main-content" class="content"><div class="main-heading"><h1 class="fqn"><span class="in-band">Module <a href="../../index.html">rustc_infer</a>::<wbr><a href="../index.html">infer</a>::<wbr><a class="mod" href="#">canonical</a><button id="copy-path" onclick="copy_path(this)" title="Copy item path to clipboard"><img src="../../../clipboard.svg" width="19" height="18" alt="Copy item path"></button></span></h1><span class="out-of-band"><a class="srclink" href="../../../src/rustc_infer/infer/canonical/mod.rs.html#1-159">source</a> ¬∑ <a id="toggle-all-docs" href="javascript:void(0)" title="collapse all docs">[<span class="inner">&#x2212;</span>]</a></span></div><details class="rustdoc-toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><p><strong>Canonicalization</strong> is the key to constructing a query in the
middle of type inference. Ordinarily, it is not possible to store
types from type inference in query keys, because they contain
references to inference variables whose lifetimes are too short
and so forth. Canonicalizing a value T1 using <code>canonicalize_query</code>
produces two things:</p>
<ul>
<li>a value T2 where each unbound inference variable has been
replaced with a <strong>canonical variable</strong>;</li>
<li>a map M (of type <code>CanonicalVarValues</code>) from those canonical
variables back to the original.</li>
</ul>
<p>We can then do queries using T2. These will give back constraints
on the canonical variables which can be translated, using the map
M, into constraints in our source context. This process of
translating the results back is done by the
<code>instantiate_query_result</code> method.</p>
<p>For a more detailed look at what is happening here, check
out the <a href="https://rust-lang.github.io/chalk/book/canonical_queries/canonicalization.html">chapter in the rustc dev guide</a>.</p>
</div></details><h2 id="modules" class="small-section-header"><a href="#modules">Modules</a></h2><div class="item-table"><div class="item-row"><div class="item-left unstable module-item"><a class="mod" href="canonicalizer/index.html" title="rustc_infer::infer::canonical::canonicalizer mod">canonicalizer</a><span title="Restricted Visibility">&nbsp;üîí</span> </div><div class="item-right docblock-short">This module contains the ‚Äúcanonicalizer‚Äù itself.</div></div><div class="item-row"><div class="item-left unstable module-item"><a class="mod" href="query_response/index.html" title="rustc_infer::infer::canonical::query_response mod">query_response</a></div><div class="item-right docblock-short">This module contains the code to instantiate a ‚Äúquery result‚Äù, and
in particular to extract out the resulting region obligations and
encode them therein.</div></div><div class="item-row"><div class="item-left unstable module-item"><a class="mod" href="substitute/index.html" title="rustc_infer::infer::canonical::substitute mod">substitute</a><span title="Restricted Visibility">&nbsp;üîí</span> </div><div class="item-right docblock-short">This module contains code to substitute new values into a
<code>Canonical&lt;'tcx, T&gt;</code>.</div></div></div><h2 id="structs" class="small-section-header"><a href="#structs">Structs</a></h2><div class="item-table"><div class="item-row"><div class="item-left unstable module-item"><a class="struct" href="struct.Canonical.html" title="rustc_infer::infer::canonical::Canonical struct">Canonical</a></div><div class="item-right docblock-short">A ‚Äúcanonicalized‚Äù type <code>V</code> is one where all free inference
variables have been rewritten to ‚Äúcanonical vars‚Äù. These are
numbered starting from 0 in order of first appearance.</div></div><div class="item-row"><div class="item-left unstable module-item"><a class="struct" href="struct.CanonicalVarInfo.html" title="rustc_infer::infer::canonical::CanonicalVarInfo struct">CanonicalVarInfo</a></div><div class="item-right docblock-short">Information about a canonical variable that is included with the
canonical value. This is sufficient information for code to create
a copy of the canonical value in some other inference context,
with fresh inference variables replacing the canonical values.</div></div><div class="item-row"><div class="item-left unstable module-item"><a class="struct" href="struct.CanonicalVarValues.html" title="rustc_infer::infer::canonical::CanonicalVarValues struct">CanonicalVarValues</a></div><div class="item-right docblock-short">A set of values corresponding to the canonical variables from some
<code>Canonical</code>. You can give these values to
<code>canonical_value.substitute</code> to substitute them into the canonical
value at the right places.</div></div><div class="item-row"><div class="item-left unstable module-item"><a class="struct" href="struct.OriginalQueryValues.html" title="rustc_infer::infer::canonical::OriginalQueryValues struct">OriginalQueryValues</a></div><div class="item-right docblock-short">When we canonicalize a value to form a query, we wind up replacing
various parts of it with canonical variables. This struct stores
those replaced bits to remember for when we process the query
result.</div></div><div class="item-row"><div class="item-left unstable module-item"><a class="struct" href="struct.QueryRegionConstraints.html" title="rustc_infer::infer::canonical::QueryRegionConstraints struct">QueryRegionConstraints</a></div></div><div class="item-row"><div class="item-left unstable module-item"><a class="struct" href="struct.QueryResponse.html" title="rustc_infer::infer::canonical::QueryResponse struct">QueryResponse</a></div><div class="item-right docblock-short">After we execute a query with a canonicalized key, we get back a
<code>Canonical&lt;QueryResponse&lt;..&gt;&gt;</code>. You can use
<code>instantiate_query_result</code> to access the data in this result.</div></div></div><h2 id="enums" class="small-section-header"><a href="#enums">Enums</a></h2><div class="item-table"><div class="item-row"><div class="item-left unstable module-item"><a class="enum" href="enum.CanonicalTyVarKind.html" title="rustc_infer::infer::canonical::CanonicalTyVarKind enum">CanonicalTyVarKind</a></div><div class="item-right docblock-short">Rust actually has more than one category of type variables;
notably, the type variables we create for literals (e.g., 22 or
22.) can only be instantiated with integral/float types (e.g.,
usize or f32). In order to faithfully reproduce a type, we need to
know what set of types a given type variable can be unified with.</div></div><div class="item-row"><div class="item-left unstable module-item"><a class="enum" href="enum.CanonicalVarKind.html" title="rustc_infer::infer::canonical::CanonicalVarKind enum">CanonicalVarKind</a></div><div class="item-right docblock-short">Describes the ‚Äúkind‚Äù of the canonical variable. This is a ‚Äúkind‚Äù
in the type-theory sense of the term ‚Äì i.e., a ‚Äúmeta‚Äù type system
that analyzes type-like values.</div></div><div class="item-row"><div class="item-left unstable module-item"><a class="enum" href="enum.Certainty.html" title="rustc_infer::infer::canonical::Certainty enum">Certainty</a></div><div class="item-right docblock-short">Indicates whether or not we were able to prove the query to be
true.</div></div></div><h2 id="types" class="small-section-header"><a href="#types">Type Definitions</a></h2><div class="item-table"><div class="item-row"><div class="item-left unstable module-item"><a class="type" href="type.CanonicalVarInfos.html" title="rustc_infer::infer::canonical::CanonicalVarInfos type">CanonicalVarInfos</a></div></div><div class="item-row"><div class="item-left unstable module-item"><a class="type" href="type.Canonicalized.html" title="rustc_infer::infer::canonical::Canonicalized type">Canonicalized</a></div></div><div class="item-row"><div class="item-left unstable module-item"><a class="type" href="type.CanonicalizedQueryResponse.html" title="rustc_infer::infer::canonical::CanonicalizedQueryResponse type">CanonicalizedQueryResponse</a></div></div><div class="item-row"><div class="item-left unstable module-item"><a class="type" href="type.QueryOutlivesConstraint.html" title="rustc_infer::infer::canonical::QueryOutlivesConstraint type">QueryOutlivesConstraint</a></div></div></div></section></div></main><div id="rustdoc-vars" data-root-path="../../../" data-current-crate="rustc_infer" data-themes="ayu,dark,light" data-resource-suffix="" data-rustdoc-version="1.66.0-dev" ></div></body></html>