<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="Lowers the AST to the HIR."><meta name="keywords" content="rust, rustlang, rust-lang, rustc_ast_lowering"><title>rustc_ast_lowering - Rust</title><link rel="preload" as="font" type="font/woff2" crossorigin href="../SourceSerif4-Regular.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../FiraSans-Regular.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../FiraSans-Medium.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../SourceCodePro-Regular.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../SourceSerif4-Bold.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../SourceCodePro-Semibold.ttf.woff2"><link rel="stylesheet" href="../normalize.css"><link rel="stylesheet" href="../rustdoc.css" id="mainThemeStyle"><link rel="stylesheet" href="../ayu.css" disabled><link rel="stylesheet" href="../dark.css" disabled><link rel="stylesheet" href="../light.css" id="themeStyle"><script id="default-settings" ></script><script src="../storage.js"></script><script defer src="../crates.js"></script><script defer src="../main.js"></script><noscript><link rel="stylesheet" href="../noscript.css"></noscript><link rel="alternate icon" type="image/png" href="../favicon-16x16.png"><link rel="alternate icon" type="image/png" href="../favicon-32x32.png"><link rel="icon" type="image/svg+xml" href="../favicon.svg"></head><body class="rustdoc mod crate"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="mobile-topbar"><button class="sidebar-menu-toggle">&#9776;</button><a class="sidebar-logo" href="../rustc_ast_lowering/index.html"><div class="logo-container"><img class="rust-logo" src="../rust-logo.svg" alt="logo"></div></a><h2 class="location"></h2></nav><nav class="sidebar"><a class="sidebar-logo" href="../rustc_ast_lowering/index.html"><div class="logo-container"><img class="rust-logo" src="../rust-logo.svg" alt="logo"></div></a><h2 class="location"><a href="#">Crate rustc_ast_lowering</a></h2><div class="sidebar-elems"><div class="block"><ul><li class="version">Version 1.66.0-dev</li><li><a id="all-types" href="all.html">All Items</a></li></ul></div><section><div class="block"><ul><li><a href="#modules">Modules</a></li><li><a href="#macros">Macros</a></li><li><a href="#structs">Structs</a></li><li><a href="#enums">Enums</a></li><li><a href="#traits">Traits</a></li><li><a href="#functions">Functions</a></li></ul></div></section></div></nav><main><div class="width-limiter"><div class="sub-container"><a class="sub-logo-container" href="../rustc_ast_lowering/index.html"><img class="rust-logo" src="../rust-logo.svg" alt="logo"></a><nav class="sub"><form class="search-form"><div class="search-container"><span></span><input class="search-input" name="search" autocomplete="off" spellcheck="false" placeholder="Click or press â€˜Sâ€™ to search, â€˜?â€™ for more optionsâ€¦" type="search"><div id="help-button" title="help" tabindex="-1"><button type="button">?</button></div><div id="settings-menu" tabindex="-1"><a href="../settings.html" title="settings"><img width="22" height="22" alt="Change settings" src="../wheel.svg"></a></div></div></form></nav></div><section id="main-content" class="content"><div class="main-heading"><h1 class="fqn"><span class="in-band">Crate <a class="mod" href="#">rustc_ast_lowering</a><button id="copy-path" onclick="copy_path(this)" title="Copy item path to clipboard"><img src="../clipboard.svg" width="19" height="18" alt="Copy item path"></button></span></h1><span class="out-of-band"><a class="srclink" href="../src/rustc_ast_lowering/lib.rs.html#1-2587">source</a> Â· <a id="toggle-all-docs" href="javascript:void(0)" title="collapse all docs">[<span class="inner">&#x2212;</span>]</a></span></div><details class="rustdoc-toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><p>Lowers the AST to the HIR.</p>
<p>Since the AST and HIR are fairly similar, this is mostly a simple procedure,
much like a fold. Where lowering involves a bit more work things get more
interesting and there are some invariants you should know about. These mostly
concern spans and IDs.</p>
<p>Spans are assigned to AST nodes during parsing and then are modified during
expansion to indicate the origin of a node and the process it went through
being expanded. IDs are assigned to AST nodes just before lowering.</p>
<p>For the simpler lowering steps, IDs and spans should be preserved. Unlike
expansion we do not preserve the process of lowering in the spans, so spans
should not be modified here. When creating a new node (as opposed to
â€œfoldingâ€ an existing one), create a new ID using <code>next_id()</code>.</p>
<p>You must ensure that IDs are unique. That means that you should only use the
ID from an AST node in a single HIR node (you can assume that AST node-IDs
are unique). Every new node must have a unique ID. Avoid cloning HIR nodes.
If you do, you must then set the new nodeâ€™s ID to a fresh one.</p>
<p>Spans are used for error messages and for tools to map semantics back to
source code. It is therefore not as important with spans as IDs to be strict
about use (you canâ€™t break the compiler by screwing up a span). Obviously, a
HIR node can only have a single span. But multiple nodes can have the same
span and spans donâ€™t need to be kept in order, etc. Where code is preserved
by lowering, it should have the same span as in the AST. Where HIR nodes are
new it is probably best to give a span for the whole AST node being lowered.
All nodes should have real spans; donâ€™t use dummy spans. Tools are likely to
get confused if the spans from leaf AST nodes occur in multiple places
in the HIR, especially for multiple identifiers.</p>
</div></details><h2 id="modules" class="small-section-header"><a href="#modules">Modules</a></h2><div class="item-table"><div class="item-row"><div class="item-left unstable module-item"><a class="mod" href="asm/index.html" title="rustc_ast_lowering::asm mod">asm</a><span title="Restricted Visibility">&nbsp;ğŸ”’</span> </div></div><div class="item-row"><div class="item-left unstable module-item"><a class="mod" href="block/index.html" title="rustc_ast_lowering::block mod">block</a><span title="Restricted Visibility">&nbsp;ğŸ”’</span> </div></div><div class="item-row"><div class="item-left unstable module-item"><a class="mod" href="errors/index.html" title="rustc_ast_lowering::errors mod">errors</a><span title="Restricted Visibility">&nbsp;ğŸ”’</span> </div></div><div class="item-row"><div class="item-left unstable module-item"><a class="mod" href="expr/index.html" title="rustc_ast_lowering::expr mod">expr</a><span title="Restricted Visibility">&nbsp;ğŸ”’</span> </div></div><div class="item-row"><div class="item-left unstable module-item"><a class="mod" href="index/index.html" title="rustc_ast_lowering::index mod">index</a><span title="Restricted Visibility">&nbsp;ğŸ”’</span> </div></div><div class="item-row"><div class="item-left unstable module-item"><a class="mod" href="item/index.html" title="rustc_ast_lowering::item mod">item</a><span title="Restricted Visibility">&nbsp;ğŸ”’</span> </div></div><div class="item-row"><div class="item-left unstable module-item"><a class="mod" href="lifetime_collector/index.html" title="rustc_ast_lowering::lifetime_collector mod">lifetime_collector</a><span title="Restricted Visibility">&nbsp;ğŸ”’</span> </div></div><div class="item-row"><div class="item-left unstable module-item"><a class="mod" href="pat/index.html" title="rustc_ast_lowering::pat mod">pat</a><span title="Restricted Visibility">&nbsp;ğŸ”’</span> </div></div><div class="item-row"><div class="item-left unstable module-item"><a class="mod" href="path/index.html" title="rustc_ast_lowering::path mod">path</a><span title="Restricted Visibility">&nbsp;ğŸ”’</span> </div></div></div><h2 id="macros" class="small-section-header"><a href="#macros">Macros</a></h2><div class="item-table"><div class="item-row"><div class="item-left unstable module-item"><a class="macro" href="macro.arena_vec.html" title="rustc_ast_lowering::arena_vec macro">arena_vec</a><span title="Restricted Visibility">&nbsp;ğŸ”’</span> </div></div></div><h2 id="structs" class="small-section-header"><a href="#structs">Structs</a></h2><div class="item-table"><div class="item-row"><div class="item-left unstable module-item"><a class="struct" href="struct.Arena.html" title="rustc_ast_lowering::Arena struct">Arena</a></div></div><div class="item-row"><div class="item-left unstable module-item"><a class="struct" href="struct.GenericArgsCtor.html" title="rustc_ast_lowering::GenericArgsCtor struct">GenericArgsCtor</a><span title="Restricted Visibility">&nbsp;ğŸ”’</span> </div><div class="item-right docblock-short">Helper struct for delayed construction of GenericArgs.</div></div><div class="item-row"><div class="item-left unstable module-item"><a class="struct" href="struct.LoweringContext.html" title="rustc_ast_lowering::LoweringContext struct">LoweringContext</a><span title="Restricted Visibility">&nbsp;ğŸ”’</span> </div></div></div><h2 id="enums" class="small-section-header"><a href="#enums">Enums</a></h2><div class="item-table"><div class="item-row"><div class="item-left unstable module-item"><a class="enum" href="enum.AstOwner.html" title="rustc_ast_lowering::AstOwner enum">AstOwner</a><span title="Restricted Visibility">&nbsp;ğŸ”’</span> </div></div><div class="item-row"><div class="item-left unstable module-item"><a class="enum" href="enum.FnDeclKind.html" title="rustc_ast_lowering::FnDeclKind enum">FnDeclKind</a><span title="Restricted Visibility">&nbsp;ğŸ”’</span> </div></div><div class="item-row"><div class="item-left unstable module-item"><a class="enum" href="enum.ImplTraitContext.html" title="rustc_ast_lowering::ImplTraitContext enum">ImplTraitContext</a><span title="Restricted Visibility">&nbsp;ğŸ”’</span> </div><div class="item-right docblock-short">Context of <code>impl Trait</code> in code, which determines whether it is allowed in an HIR subtree,
and if so, what meaning it has.</div></div><div class="item-row"><div class="item-left unstable module-item"><a class="enum" href="enum.ImplTraitPosition.html" title="rustc_ast_lowering::ImplTraitPosition enum">ImplTraitPosition</a><span title="Restricted Visibility">&nbsp;ğŸ”’</span> </div><div class="item-right docblock-short">Position in which <code>impl Trait</code> is disallowed.</div></div><div class="item-row"><div class="item-left unstable module-item"><a class="enum" href="enum.ParamMode.html" title="rustc_ast_lowering::ParamMode enum">ParamMode</a><span title="Restricted Visibility">&nbsp;ğŸ”’</span> </div></div><div class="item-row"><div class="item-left unstable module-item"><a class="enum" href="enum.ParenthesizedGenericArgs.html" title="rustc_ast_lowering::ParenthesizedGenericArgs enum">ParenthesizedGenericArgs</a><span title="Restricted Visibility">&nbsp;ğŸ”’</span> </div></div></div><h2 id="traits" class="small-section-header"><a href="#traits">Traits</a></h2><div class="item-table"><div class="item-row"><div class="item-left unstable module-item"><a class="trait" href="trait.ArenaAllocatable.html" title="rustc_ast_lowering::ArenaAllocatable trait">ArenaAllocatable</a></div></div><div class="item-row"><div class="item-left unstable module-item"><a class="trait" href="trait.ResolverAstLoweringExt.html" title="rustc_ast_lowering::ResolverAstLoweringExt trait">ResolverAstLoweringExt</a><span title="Restricted Visibility">&nbsp;ğŸ”’</span> </div></div></div><h2 id="functions" class="small-section-header"><a href="#functions">Functions</a></h2><div class="item-table"><div class="item-row"><div class="item-left unstable module-item"><a class="fn" href="fn.compute_hir_hash.html" title="rustc_ast_lowering::compute_hir_hash fn">compute_hir_hash</a><span title="Restricted Visibility">&nbsp;ğŸ”’</span> </div><div class="item-right docblock-short">Compute the hash for the HIR of the full crate.
This hash will then be part of the crate_hash which is stored in the metadata.</div></div><div class="item-row"><div class="item-left unstable module-item"><a class="fn" href="fn.index_crate.html" title="rustc_ast_lowering::index_crate fn">index_crate</a><span title="Restricted Visibility">&nbsp;ğŸ”’</span> </div></div><div class="item-row"><div class="item-left unstable module-item"><a class="fn" href="fn.lower_to_hir.html" title="rustc_ast_lowering::lower_to_hir fn">lower_to_hir</a></div></div></div></section></div></main><div id="rustdoc-vars" data-root-path="../" data-current-crate="rustc_ast_lowering" data-themes="ayu,dark,light" data-resource-suffix="" data-rustdoc-version="1.66.0-dev" ></div></body></html>